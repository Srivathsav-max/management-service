<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Service Nodes</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .controls { margin-bottom: 20px; }
        .controls select, .controls input, .controls button { margin-right: 10px; padding: 5px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .clickable { color: #0066cc; cursor: pointer; }
        .actions { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .actions button { padding: 5px 10px; }
    </style>
</head>
<body>
    <h1>Service Nodes</h1>
    
    <div class="controls">
        <input type="text" id="searchInput" placeholder="Search" />
        <select id="filter">
            <option value="">Select Filter</option>
            <option value="Transponder">Transponder</option>
            <option value="Receiver">Receiver</option>
        </select>

        <form th:action="@{/api/services/bulk-import}" method="post" enctype="multipart/form-data">
            <input type="file" name="file" required />
            <button type="submit">Bulk Import Nodes</button>
        </form>
    </div>
    
    <div class="actions">
        <div>
            <button><i class="fas fa-pencil-alt"></i></button>
            <button><i class="far fa-copy"></i></button>
            <button id="exportCsvButton"><i class="fas fa-download"></i>Export to CSV</button>
            <button><i class="fas fa-ellipsis-v"></i></button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th><input type="checkbox" /></th>
                <th>Node ID <i class="fas fa-sort"></i></th>
                <th>Node name <i class="fas fa-sort"></i></th>
                <th>Description</th>
                <th>Memo</th>
                <th>Node type</th>
                <th>Parent node group name <i class="fas fa-sort"></i></th>
                <th>Parent node group ID <i class="fas fa-sort"></i></th>
                <th>Parent node ID <i class="fas fa-sort"></i></th>
            </tr>
        </thead>
        <tbody th:each="node : ${nodes}">
            <tr>
                <td><input type="checkbox" /></td>
                <td th:text="${node.nodeId}">Node ID</td>
                <td class="clickable" th:text="${node.nodeName}">Node Name</td>
                <td th:text="${node.description}">Description</td>
                <td th:text="${node.memo}">Memo</td>
                <td th:text="${node.nodeType}">Node Type</td>
                <td th:text="${node.parentNodeGroupName}">Parent Node Group Name</td>
                <td th:text="${node.parentNodeGroupId}">Parent Node Group ID</td>
                <td th:text="${node.parentNodeGroupType}">Parent Node Group Type</td>
            </tr>
        </tbody>
    </table>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#searchInput').on('keyup', function() {
                updateTable($(this).val(), $('#filter').val());
            });

            $('#filter').on('change', function() {
                updateTable($('#searchInput').val(), $(this).val());
            });
            $('#exportCsvButton').click(function() {
                window.location.href = '/export-csv';
            });

            function updateTable(search, filter) {
                $.ajax({
                    url: '/api/services/fetch',
                    type: 'GET',
                    data: {
                        search: search,
                        filterBy: 'nodeType', 
                        filterValue: filter
                    },
                    success: function(data) {
                        var rows = '';
                        data.forEach(function(node) {
                            rows += '<tr>' +
                                    '<td><input type="checkbox" /></td>' +
                                    '<td>' + node.nodeId + '</td>' +
                                    '<td class="clickable">' + node.nodeName + '</td>' +
                                    '<td>' + node.description + '</td>' +
                                    '<td>' + node.memo + '</td>' +
                                    '<td>' + node.nodeType + '</td>' +
                                    '<td>' + node.parentNodeGroupName + '</td>' +
                                    '<td>' + node.parentNodeGroupId + '</td>' +
                                    '<td>' + node.parentNodeGroupType + '</td>' +
                                    '</tr>';
                        });
                        $('tbody').html(rows);
                    },
                    error: function() {
                        alert('Error fetching data');
                    }
                });
            }
        });
    </script>
</body>
</html>